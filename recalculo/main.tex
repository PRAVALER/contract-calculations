\documentclass{article}
\usepackage[subpreambles=true]{standalone}
\usepackage{
  import,
  amssymb,
  amsfonts,
  fancyhdr,
  mathtools,
  enumitem,
  varwidth,
  titlesec,
  indentfirst
}

\import{./config/}{style.tex}
\import{./config/}{format.tex}
\import{./config/}{output.tex}
\input{./formulas/parametros.sty}
\input{./formulas/parcela.sty}
\input{./formulas/juros.sty}

\title{Recálculo}
\author{Liberação de Crédito}
\begin{document}
\maketitle

\section{Introdução}{
  O recálculo é um processo que permite ao cliente ajustar o valor do seu crédito
  de acordo com as suas necessidades. No caso, ajustar o valor das parcelas com
  base na data de concessão.

  \subsection{Preparação das informações}{
    Os cálculos iniciam com a preparação de algumas informações, como:
    \begin{equation}
      \taxaJuros
    \end{equation}
    \vspace{0.1mm}
    \begin{center}
      \begin{varwidth}{\textwidth}
        \begin{enumerate}
          \item{$t$\@: taxa de juros do contrato}
          \item{$j$\@: taxa de juros mensal}
        \end{enumerate}
      \end{varwidth}
    \end{center}
    \vspace{5mm}

    O conjunto de prazos que são a diferença, em dias, entre a data da concessão
    e a data de vencimento da parcela, predefinida na etapa de formalização.
    \begin{equation}
      \prazo
    \end{equation}
    \vspace{0.1mm}
    \begin{center}
      \begin{varwidth}{\textwidth}
        \begin{enumerate}
          \item{$p$\@: prazo elemento de P, com p $\in$ $\mathbb{N_{+}^*}$}
          \item{$k$\@: a quantidade de parcelas, com k $\in$ $\mathbb{N_{+}^*}$}
        \end{enumerate}
      \end{varwidth}
    \end{center}
    \vspace{5mm}

    O valor inicial da parcela entendido, essencialmente, como a razão entre o
    valor financiado e a quantidade de parcelas, menos um valor fixo.
    \begin{equation}
      \valorInicial
    \end{equation}
    \vspace{0.1mm}
    \begin{center}
      \begin{varwidth}{\textwidth}
        \begin{enumerate}
          \item{$vi$\@: valor inicial da parcela}
          \item{$vf$\@: valor financiado}
          \item{$C$\@: uma constante não definida tida como 0,01}
        \end{enumerate}
      \end{varwidth}
    \end{center}
  }
 }

\section{Cálculo da parcela}{
  O cálculo passa por uma série de repetições dentro de outras repetições.
  Muitas dessas repetições têm por objetivo, por exemplo, determinar a taxa de
  juros, através de uma simulação de cálculos. Essas simulações propõe atingir um
  determinado valor, funcionando como um critério de parada.

  \subsection{Cálculo do pagamento}{
    Essa etapa é responsável pelo cálculo do valor da parcela e do valor amortizado.
    Entretanto, para que isso seja possível, é necessário termos em mãos o valor
    do \textbf{fator de cálculo total}.

    \subsubsection{Fator de cálculo}{
      O fator de cálculo é obtido através da soma dos fatores parcias ($f_{p_{i}}$)
      que são obtidos através da lista de prazos ($P$) previamente definida. Esse
      procedimento nos fornecerá um conjunto de fatores parciais possibilitando
      o cálculo de fator de cálculo total através da soma dos mesmos. Portanto,
      assuma $F$ como o conjunto desses fatores parciais.
      \begin{equation*}
        F = \{f_{p_{1}}, \ldots, f_{p_{k}}\}
      \end{equation*}
      \pagebreak

      \begin{equation}
        \fatorParcial \rightarrow f_{t} = \sum\limits_{i = 1} ^ {k} f_{p_{i}}
      \end{equation}
      \begin{equation*}\therefore\end{equation*}
      \begin{equation}\fatorTotal\end{equation}
      \vspace{0.1mm}
      \begin{center}
        \begin{varwidth}{\textwidth}
          \begin{enumerate}
            \item{$f_{p_{i}}$\@: fator parcial do cálculo}
            \item{$p_{i}$: um elemento qualquer do conjunto de prazos}
            \item{$f_{t}$\@: fator de cálculo total}
            \item{$f_{p_{i}}$\@: fator parcial do cálculo}
            \item{$p_{i}$: um elemento qualquer do conjunto de prazos}
          \end{enumerate}
        \end{varwidth}
      \end{center}
    }

    \subsubsection{Cálculo da parcela}{
      Neste momento, somos capazes de efetuar o cálculo do valor da parcela.
      \begin{equation} \label{eq:parcela}
        vp = \frac{vf}{f_{t}} \rightarrow \parcela
      \end{equation}
      \vspace{0.1mm}
      \begin{center}
        \begin{varwidth}{\textwidth}
          \begin{enumerate}
            \item{$vp$\@: valor da parcela}
          \end{enumerate}
        \end{varwidth}
      \end{center}
    }

    \subsubsection{Cálculo do valor amortizado}{
      Outro calculo realizado pelo recálculo é o cálculo do valor amortizado.
      Para isso, precisamos calcular o juros referente à cada prazo.
      \begin{equation}
        \juros
      \end{equation}
      \vspace{0.1mm}
      \begin{center}
        \begin{varwidth}{\textwidth}
          \begin{enumerate}
            \item{$j_{i}$\@: juros referente a um prazo}
            \item{$s_{i}$\@: saldo devedor referente a um prazo}
            \item{$p_{i} ^ \prime$\@: prazo anterior ao prazo atual}
            \item{$i$\@: número variando \{1 $\ldots$ k\}}
          \end{enumerate}
        \end{varwidth}
      \end{center}
      \vspace{5mm}

      Esse cálculo nos possibilita calcular o valor amortizado total.
      \begin{equation}
        a_{i} = vp - j_{i} \rightarrow \amortizado
      \end{equation}
      \begin{equation*}\therefore\end{equation*}
      \begin{equation}\amortizadoSimplificado\end{equation}
      \vspace{0.1mm}
      \begin{center}
        \begin{varwidth}{\textwidth}
          \begin{enumerate}
            \item{$j_{i}$\@: juros referente a um prazo}
            \item{$a_{t}$\@: amortizado total}
          \end{enumerate}
        \end{varwidth}
      \end{center}
    }
  }
 }

\section{Cálculo do valor financiado com IOF}{
  Esse é mais um passo fundamental para o cálculo do contrato. Para que seja
  possível a obtenção deste valor, usamos como input o valor do da parcela
  anteriormente calculado.

  \subsection{Cálculo do valor presente da parcela}{
    Num primeiro momento, é necessário que tenhamos o valor presente da parcela
    $(vpp_{i})$ referente ao prazo do conjunto de prazos.
    \begin{equation}
      \valorPresenteParcela
    \end{equation}
    \vspace{0.1mm}
    \begin{center}
      \begin{varwidth}{\textwidth}
        \begin{enumerate}
          \item{$vpp_{i}$\@: juros referente a um prazo}
          \item{$y$\@: pode ser o prazo ou uma constante}
                \subitem $$
                  y = \begin{cases}
                    p_{i}, & \text{se houver aplicação de IOF no contrato} \\
                    365,   & \text{caso contrário}
                  \end{cases}
                $$
        \end{enumerate}
      \end{varwidth}
    \end{center}
  }

  \subsection{Cálculo do valor presente da parcela}{
    Assim como a operação do valor presente parcial, também dependemos do valor
    do IOF parcial que será usado para o cálculo do IOF total.
    \begin{equation}
      \iofFinalParcial
    \end{equation}
    \vspace{0.1mm}
    \begin{center}
      \begin{varwidth}{\textwidth}
        \begin{enumerate}
          \item{$iof_{a}$\@: IOF adicional, uma contante fixa no valor de 0.38}
          \item{$iof_{d}$\@: IOF diário, uma contante fixa no valor de 0.0082}
        \end{enumerate}
      \end{varwidth}
    \end{center}
    \vspace{5mm}

    Importante notar que tanto $iof_{a}$ como $iof_{d}$ podem ser zerados, caso
    não haja aplicabilidade de IOF no contrato. Com o cálculo do $iof_{f,i}$
    conseguimos deduzir o IOF total.
    \begin{equation}
      \iofTotal
    \end{equation}
  }

  \subsection{Cálculo do valor financiado com IOF}{
    Finalmente, temos o que precisamos para calcular o valor financiado.
    \begin{equation} \label{eq:vfIof}
      vf ^ \prime = iof_{t} \cdot \frac{vf}{vf - iof_{t}}
    \end{equation}
  }
 }

\section{Cálculo do $CET_{am}$}{
  Fomos guiados até esse momento para que podéssemos calcular o CET ao mês, isto
  é, custo efetivo total referente ao contrato. Entretando, prepararemos alguns
  dados, pois são requisitos da operção.

  \subsection{Cálculo do juros}{
    Para calcular o juros, excutamos uma operação incremental que atualizará o
    juros aos poucos. O juros será influenciado por uma variável chamada parcial,
    que possui como objetivo atingir o valor financiado. Logo, suponha a função
    $g(pa)$ que retorna o valor do parcial após k iterações. A função $g(pa)$
    será executada um número indeterminado de vezes e, conforme dito anteriormente,
    a taxa de juros sofrerá alterações. Ou seja, ela dependerá do limite de $g(pa)$
    quando o parcial ($pa$) tende ao valor financiado ($vf$):
    \begin{equation}
      \lim_{pa \to vf} g(pa_{j}) = (f \circ f \circ \ldots \circ f)(pa_{j})
    \end{equation}

    onde $f(pa)$:
    \begin{equation}
      f(pa) = pa + \Bigg[\frac{vp}{(1 + t_{j}) ^ {\frac{p_{i}}{30}}}\Bigg]
    \end{equation}
    \vspace{0.1mm}
    \begin{center}
      \begin{varwidth}{\textwidth}
        \begin{enumerate}
          \item{$pa$\@: parcial}
          \item{$t_{j}$\@: juros calculado}
          \item{$f(pa)$\@: função parte do cálculo do parcial}
        \end{enumerate}
      \end{varwidth}
    \end{center}
    \vspace{5mm}

    Para cada iteração de $g(pa)$ o juros $t_{j + 1}$ é obtido da seguinte forma:
    \begin{equation}
      t_{j + 1} = t_{j} + I
    \end{equation}
    \vspace{0.1mm}
    \begin{center}
      \begin{varwidth}{\textwidth}
        \begin{enumerate}
          \item{$t_{j + 1}$\@: o próximo valor do juros}
          \item{$I$\@: incremento pré definido no valor de 0,00001}
        \end{enumerate}
      \end{varwidth}
    \end{center}
  }
 }

\section{Cálculo valor limite da parcela}{
  Limite da parcela

  \subsection{Cálculo valor incremental final}{
    Para isso retornamos ao cálculo do valor da parcela (\ref{eq:parcela}), mas
    dessa vez tendo o valor financiado com IOF (\ref{eq:vfIof}) como input.
    Teremos então:
    \begin{equation}
      \parcelaPrime
    \end{equation}
    \vspace{0.1mm}
    \begin{center}
      \begin{varwidth}{\textwidth}
        \begin{enumerate}
          \item{$vf ^ \prime$\@: valor financiado com IOF}
          \item{$vp ^ \prime$\@: valor da parcela}
        \end{enumerate}
      \end{varwidth}
    \end{center}
  }
 }
\end{document}
