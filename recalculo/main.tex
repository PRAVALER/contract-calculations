\documentclass{article}
\usepackage[subpreambles=true]{standalone}
\usepackage{
  import,
  amssymb,
  amsfonts,
  fancyhdr,
  mathtools,
  enumitem,
  varwidth,
  titlesec,
  indentfirst
}

\import{./config/}{style.tex}
\import{./config/}{format.tex}
\import{./config/}{output.tex}
\input{./formulas/parametros.sty}
\input{./formulas/parcela.sty}
\input{./formulas/juros.sty}

\title{Recálculo}
\author{Liberação de Crédito}
\begin{document}
\maketitle

\section{Introdução}{
  O recálculo é um processo que permite ao cliente ajustar o valor do seu crédito
  de acordo com as suas necessidades. No caso, ajustar o valor das parcelas com
  base na data de concessão.

  \subsection{Preparação das informações}{
    Os cálculos iniciam com a preparação de algumas informações, como:
    \begin{equation}
      \taxaJuros
    \end{equation}
    \vspace{0.1mm}
    \begin{center}
      \begin{varwidth}{\textwidth}
        \begin{enumerate}
          \item{$t$\@: taxa de juros do contrato}
          \item{$j$\@: taxa de juros mensal}
        \end{enumerate}
      \end{varwidth}
    \end{center}
    \vspace{5mm}

    O conjunto de prazos que são a diferença, em dias, entre a data da concessão
    e a data de vencimento da parcela, predefinida na etapa de formalização.
    \begin{equation}
      \prazo
    \end{equation}
    \vspace{0.1mm}
    \begin{center}
      \begin{varwidth}{\textwidth}
        \begin{enumerate}
          \item{$p$\@: prazo elemento de P, com p $\in$ $\mathbb{N_{+}^*}$}
          \item{$k$\@: a quantidade de parcelas, com k $\in$ $\mathbb{N_{+}^*}$}
        \end{enumerate}
      \end{varwidth}
    \end{center}
    \vspace{5mm}

    O valor inicial da parcela entendido, essencialmente, como a razão entre o
    valor financiado e a quantidade de parcelas, menos um valor fixo.
    \begin{equation}
      \valorInicial
    \end{equation}
    \vspace{0.1mm}
    \begin{center}
      \begin{varwidth}{\textwidth}
        \begin{enumerate}
          \item{$vi$\@: valor inicial da parcela}
          \item{$vf$\@: valor financiado}
          \item{$C$\@: uma constante não definida tida como 0,01}
        \end{enumerate}
      \end{varwidth}
    \end{center}
  }
 }

\section{Cálculo da parcela}{
  O cálculo passa por uma série de repetições dentro de outras repetições.
  Muitas dessas repetições têm por objetivo, por exemplo, determinar a taxa de
  juros, através de uma simulação de cálculos. Essas simulações propõe atingir um
  determinado valor, funcionando como um critério de parada.

  \subsection{Cálculo do pagamento}{
    Essa etapa é responsável pelo cálculo do valor da parcela e do valor amortizado.
    Entretanto, para que isso seja possível, é necessário termos em mãos o valor
    do \textbf{fator de cálculo total}.

    \subsubsection{Fator de cálculo}{
      O fator de cálculo é obtido através da soma dos fatores parcias ($f_{p_{i}}$)
      que são obtidos através da lista de prazos ($P$) previamente definida. Esse
      procedimento nos fornecerá um conjunto de fatores parciais possibilitando
      o cálculo de fator de cálculo total através da soma dos mesmos. Portanto,
      assuma $F$ como o conjunto desses fatores parciais.
      \begin{equation*}
        F = \{f_{p_{1}}, \ldots, f_{p_{k}}\}
      \end{equation*}

      \begin{equation}
        \fatorParcial \rightarrow f_{t} = \sum\limits_{i = 1} ^ {k} f_{p_{i}}
      \end{equation}
      \begin{equation*}\therefore\end{equation*}
      \begin{equation}\fatorTotal\end{equation}
      \vspace{0.1mm}
      \begin{center}
        \begin{varwidth}{\textwidth}
          \begin{enumerate}
            \item{$f_{p_{i}}$\@: fator parcial do cálculo}
            \item{$p_{i}$: um elemento qualquer do conjunto de prazos}
            \item{$f_{t}$\@: fator de cálculo total}
            \item{$f_{p_{i}}$\@: fator parcial do cálculo}
            \item{$p_{i}$: um elemento qualquer do conjunto de prazos}
          \end{enumerate}
        \end{varwidth}
      \end{center}
    }

    \subsubsection{Cálculo da parcela}{
      Neste momento, somos capazes de efetuar o cálculo do valor da parcela.
      \begin{equation} \label{eq:parcela}
        vp = \frac{vf}{f_{t}} \rightarrow \parcela
      \end{equation}
      \vspace{0.1mm}
      \begin{center}
        \begin{varwidth}{\textwidth}
          \begin{enumerate}
            \item{$vp$\@: valor da parcela}
          \end{enumerate}
        \end{varwidth}
      \end{center}
    }

    \subsubsection{Cálculo do valor amortizado}{
      Outro calculo realizado pelo recálculo é o cálculo do valor amortizado.
      Para isso, precisamos calcular o juros referente à cada prazo.
      \begin{equation}
        \juros
      \end{equation}
      \vspace{0.1mm}
      \begin{center}
        \begin{varwidth}{\textwidth}
          \begin{enumerate}
            \item{$j_{i}$\@: juros referente a um prazo}
            \item{$s_{i}$\@: saldo devedor referente a um prazo}
            \item{$p_{i} ^ \prime$\@: prazo anterior ao prazo atual}
            \item{$i$\@: número variando \{1 $\ldots$ k\}}
          \end{enumerate}
        \end{varwidth}
      \end{center}
      \vspace{5mm}

      Esse cálculo nos possibilita calcular o valor amortizado total.
      \begin{equation}
        a_{i} = vp - j_{i} \rightarrow \amortizado
      \end{equation}
      \begin{equation*}\therefore\end{equation*}
      \begin{equation}\amortizadoSimplificado\end{equation}
      \vspace{0.1mm}
      \begin{center}
        \begin{varwidth}{\textwidth}
          \begin{enumerate}
            \item{$j_{i}$\@: juros referente a um prazo}
            \item{$a_{t}$\@: amortizado total}
          \end{enumerate}
        \end{varwidth}
      \end{center}
    }
  }
 }

\section{Cálculo do valor financiado com IOF}{
  Esse é mais um passo fundamental para o cálculo do contrato. Para que seja
  possível a obtenção deste valor, usamos como input o valor do da parcela
  anteriormente calculado.

  \subsection{Cálculo do valor presente da parcela}{
    Num primeiro momento, é necessário que tenhamos o valor presente da parcela
    $(vpp_{i})$ referente ao prazo do conjunto de prazos.
    \begin{equation}
      \valorPresenteParcela
    \end{equation}
    \vspace{0.1mm}
    \begin{center}
      \begin{varwidth}{\textwidth}
        \begin{enumerate}
          \item{$vpp_{i}$\@: juros referente a um prazo}
          \item{$y$\@: pode ser o prazo ou uma constante}
                \subitem $$
                  y = \begin{cases}
                    p_{i}, & \text{se houver aplicação de IOF no contrato} \\
                    365,   & \text{caso contrário}
                  \end{cases}
                $$
        \end{enumerate}
      \end{varwidth}
    \end{center}
  }

  \subsection{Cálculo do valor presente da parcela}{
    Assim como a operação do valor presente parcial, também dependemos do valor
    do IOF parcial que será usado para o cálculo do IOF total.
    \begin{equation}
      \iofFinalParcial
    \end{equation}
    \vspace{0.1mm}
    \begin{center}
      \begin{varwidth}{\textwidth}
        \begin{enumerate}
          \item{$iof_{a}$\@: IOF adicional, uma contante fixa no valor de 0.38}
          \item{$iof_{d}$\@: IOF diário, uma contante fixa no valor de 0.0082}
        \end{enumerate}
      \end{varwidth}
    \end{center}
    \vspace{5mm}

    Importante notar que tanto $iof_{a}$ como $iof_{d}$ podem ser zerados, caso
    não haja aplicabilidade de IOF no contrato. Com o cálculo do $iof_{f,i}$
    conseguimos deduzir o IOF total.
    \begin{equation}
      \iofTotal
    \end{equation}
  }

  \subsection{Cálculo do valor financiado com IOF}{
    Finalmente, temos o que precisamos para calcular o valor financiado.
    \begin{equation} \label{eq:vfIof}
      vf ^ \prime = iof_{t} \cdot \frac{vf}{vf - iof_{t}}
    \end{equation}
  }
 }

\section{Cálculo do $CET_{am}$ parcial}{
  Fomos guiados até esse momento para que pudéssemos calcular o CET ao mês, isto
  é, custo efetivo total referente ao contrato. Entretanto, prepararemos alguns
  dados, pois são requisitos da operação.

  \subsection{Cálculo do juros}{
    Para calcular o juros, executamos uma operação incremental que atualizará o
    juros aos poucos. O juros será influenciado por uma variável chamada parcial,
    que possui como objetivo atingir o valor financiado. Logo, suponha a função
    $g(pa)$ que retorna o valor do parcial após k iterações. A função $g(pa)$
    será executada um número indeterminado de vezes e, conforme dito anteriormente,
    a taxa de juros sofrerá alterações. Ou seja, ela dependerá do limite de $g(pa)$
    quando o parcial ($pa$) tende ao valor financiado ($vf$):
    \begin{equation}
      \limitVF
    \end{equation}

    onde $f(pa)$:
    \begin{equation}
      \parcial
    \end{equation}
    \vspace{0.1mm}
    \begin{center}
      \begin{varwidth}{\textwidth}
        \begin{enumerate}
          \item{$pa$\@: parcial}
          \item{$t_{j}$\@: juros calculado}
          \item{$f(pa)$\@: função parte do cálculo do parcial}
        \end{enumerate}
      \end{varwidth}
    \end{center}
    \vspace{5mm}

    Para cada iteração de $g(pa)$ o juros $t_{j + 1}$ é obtido da seguinte forma:
    \begin{equation}
      \cetParcial
    \end{equation}
    \vspace{0.1mm}
    \begin{center}
      \begin{varwidth}{\textwidth}
        \begin{enumerate}
          \item{$t_{j + 1}$\@: o próximo valor do juros}
          \item{$I$\@: incremento pré definido no valor de 0,00001}
        \end{enumerate}
      \end{varwidth}
    \end{center}
    \vspace{5mm}

    Logo para obtermos o juros total, efetuamos a soma dos juros parciais:
    \begin{equation}
      t ^ \prime = \sum\limits_{j = 1} ^ {n} t_{j}
    \end{equation}
  }

  \subsection{Consolidação do CET}{
    A partir desse ponto é possível calcularmos o valor do CET:
    \begin{equation}
      CET_{am} = t ^ \prime \cdot 100
    \end{equation}
  }
 }

\section{Cálculo valor limite da parcela}{
  Esse é o ponto das operações de cálculo em que é decidido um dos possíveis
  valores finais da parcela. Será definido que a parcela assumirá o valor encontrado
  que foi descrito no item (\ref{eq:parcela}) ou o valor limite da parcela ($vl$)
  e podemos escrever da seguinte maneira:
  $$
    y = \begin{cases}
      vp > vl \rightarrow   & vp = vl \\
      vp <= vl, \rightarrow & vp
    \end{cases}
  $$

  Para que possamos definir o valor do valor limite da parcela é necessário calcularmos
  o valor incremental final.

  \subsection{Cálculo valor incremental final}{
    O valor incremental também é entendido como o valor financiado com IOF pelo
    processo como é feito hoje. Dito isso, para o cálculo do valor incremental,
    retornamos ao cálculo do valor da parcela (\ref{eq:parcela}), mas dessa vez
    tendo o valor financiado com IOF (\ref{eq:vfIof}) como input. Logo, teremos
    o valor incremental será:
    \begin{equation}
      \parcelaPrime
    \end{equation}
    \vspace{0.1mm}
    \begin{center}
      \begin{varwidth}{\textwidth}
        \begin{enumerate}
          \item{$\mathcal{E}$\@: valor financiado com IOF}
          \item{$vp ^ \prime$\@: valor da parcela}
        \end{enumerate}
      \end{varwidth}
    \end{center}
  }

  \subsection{Cálculo da parcela final}{
    O valor limite da parcela é obtido através da seguinte equação:
    \begin{equation}
      \valorLimiteParcelaSimple
    \end{equation}
  }
 }

\section{Cálculo final dos valores do $CETam$ e $CETaa$}{
  O processo de obtenção dos valores pode ser dividida em alguns passos, desde
  a preparação dos dados até a execução dos algorítimos.

  \subsection{Preparação dos dados}{
    Antes de iniciarmos as operações para obtenção dessas informações, precisamos
    preparar as variáveis que serão usadas durante o processo. É importante salientar
    que algumas delas serão atualizadas no decorrer dos cálculos. Teremos:
    \begin{itemize}
      \item{$v_{t}$\@: valor total no valor igual 0}
      \item{$x_{1}$\@: um tipo de taxa igual inicial a 0}
      \item{$x_{1} ^ \prime$\@: um tipo de taxa inicial igual a 0.01}
      \item{$g$\@: chute inicial no valor de 0.01}
      \item{$CET$\@: conjunto especial de elementos. Veja abaixo:}
            \begin{center}
              $CET = \{\alpha_{1}, \cdots, \alpha_{k + 1}\}$ onde
              $\alpha_{1} = vf \cdot (-1)\ \land\ $
              $\alpha_{i} = vp$
            \end{center}
            \begin{center}
              Considerando $i = \{2, \cdots, k + 1\}$
            \end{center}
      \item{$CET_{d}$\@ = \{0, P\}, conjunto com os prazos iniciando em zero}
            \begin{center}
              $CET_{d} = \{d_{1}, \cdots, d_{k + 1}\}$ onde
              $d_{1} = 0\ \land\ $
              $d_{i} \in P$
            \end{center}
            \begin{center}
              Considerando $i = \{2, \cdots, k + 1\}$
            \end{center}
      \item{$f_{1}$: componente determinante no cálculo}
            \begin{center}
              $
                f_{1} = \xnvpFUm
              $
              onde $
                $$
                  C = \begin{cases}
                    -v_{t}, & v_{t} > 0  \\
                    0,      & v_{t} <= 0
                  \end{cases}
                $$
              $
            \end{center}
      \item{$f_{2}$: componente determinante no cálculo}
            \begin{center}
              $
                f_{2} = \xnvpFDois
              $
              onde $
                $$
                  C = \begin{cases}
                    -v_{t}, & v_{t} > 0  \\
                    0,      & v_{t} <= 0
                  \end{cases}
                $$
              $
            \end{center}
    \end{itemize}
  }

  \subsection{Encontrando as taxas $x_{t}$ e $x_{t} ^ \prime$}{
    A partir desse ponto iniciaremos uma série de interações onde os critérios de
    parada serão:
    \begin{itemize}
      \item{O atingimento do número máximo de execuções ou}
      \item{$f_{1} \cdot f_{2} = 0$}
    \end{itemize}
    Logo, a cada iteração, definiremos o valor de $f_{1}$:
    \begin{equation*}
      x_{j + 1} = (x_{j} - x_{j} ^ \prime) \cdot 1.6 + x_{j} \longleftrightarrow |f_{1}| < |f_{2}|
    \end{equation*}
    \begin{equation*}
      f_{1} = \begin{cases}
        \xnvpFUm, & \longleftrightarrow |f_{1}| < |f_{2}| \\
        f_{1},    & \text{caso contrário}
      \end{cases}
    \end{equation*}
    Bem como o valor de $f_{2}$:
    \begin{equation*}
      \taxaDois \longleftrightarrow |f_{1}| >= |f_{2}|
    \end{equation*}
    \begin{equation*}
      f_{1} = \begin{cases}
        \xnvpFDois, & \longleftrightarrow |f_{1}| < |f_{2}| \\
        f_{1},      & \text{caso contrário}
      \end{cases}
    \end{equation*}
    Ao final teremos um conjunto com todas os valores de  $x_{t}$ e $x_{t} ^ \prime$,
    possibilitando o cálculo das taxas totais para ambos. Em termos matemáticos:
    \begin{equation*}
      x_{i} \in X = \{x_{1}, \cdots, x_{n}\}
    \end{equation*}
    \begin{equation*}
      x_{i} ^ \prime \in X ^ \prime = \{x_{1} ^ \prime, \cdots, x_{n} ^ \prime\}
    \end{equation*}
    \begin{equation}
      x_{t} = x_{1} + \sum\limits_{i = 1} ^ {n} [\taxaUmModule]
    \end{equation}
    \begin{equation}
      x_{t} ^ \prime = x_{1} ^ \prime + \sum\limits_{i = 1} ^ {n} [\taxaDoisModule]
    \end{equation}
  }

  \subsection{Obtenção do valor do $CET_{aa}$}{
    Considere a configuração de algumas variáveis:
    \begin{equation}
      \beta = C + \sum\limits_{i = 1} ^ {k + 1} \frac{\alpha_{i}}{(1 + x_{t}) ^ \frac{d_{i}}{365}}
    \end{equation}
    $$
      rtb = \begin{cases}
        x_{t},          & \longleftrightarrow \beta < 0 \\
        x_{t} ^ \prime, & \text{caso contrário}
      \end{cases}
    $$
    \vspace{0.1mm}
    $$
      dx = \begin{cases}
        x_{t} ^ \prime - x_{t}, & \longleftrightarrow \beta < 0 \\
        x_{t} - x_{t} ^ \prime, & \text{caso contrário}
      \end{cases}
    $$
    \vspace{5mm}

    No processo o $CET_{aa}$ é entendido como $h$ e suas iterações terão como
    critério de parada se $f(h) < 1 \cdot 10 ^ {-8}\ \lor\ |dx| < 1 \cdot 10 ^ {-8}$
    e ocorrerão da seguinte forma:
    $$
      dx_{i + 1} = dx_{i} \cdot 0,5 \rightarrow dx_{i + 1} = \frac{dx_{i}}{2}
    $$
    \vspace{0.1mm}
    $$
      h = rtb + dx_{i}\ \land\
      f(h) = C + \sum\limits_{i = 1} ^ {k + 1} \frac{\alpha_{i}}{(1 + h) ^ \frac{d_{i}}{365}}
    $$
    \vspace{0.1mm}
    $$
      rtb = \begin{cases}
        h,   & \longleftrightarrow f(h) <= 0 \\
        rtb, & \text{caso contrário}
      \end{cases}
    $$
    $$\therefore$$
    \begin{center}
      $
        CET_{aa} = f(h)
        \text{ em determinada etapa do processo de interações}
      $
    \end{center}
  }

  \subsection{Obtenção do valor do $CET_{am}$}{
    Para a alegria de muitos, $CET_{am}$ é mais simples de ser achado:
    \begin{equation}
      CET_{am} = [(1 + CET_{aa}) ^ {(\frac{30}{365})}] - 1
    \end{equation}
  }

  \subsection{Fator crítico de mudança}{
    Ambos os cálculos podem tornar-se zerados, vide regra abaixo:
    \begin{equation*}
      CET_{aa} = 0 \longleftrightarrow CET_{aa} < 0
    \end{equation*}
    \begin{equation*}
      CET_{am} = 0 \longleftrightarrow CET_{am} < 0
    \end{equation*}
  }
 }
\end{document}
